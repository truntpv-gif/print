<!DOCTYPE html>
<html>
<head>
    <title>PHIẾU GIAO HÀNG</title>
    <style>
        @page {
            size: A4;
            margin: 0;
        }

        body {
            font-family: 'Times New Roman', Times, serif;
            margin: 0;
            padding: 2cm;
            box-sizing: border-box;
            position: relative;
        }

        .watermark {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 80px;
            color: rgba(0, 0, 0, 0.1);
            z-index: -1;
            white-space: nowrap;
            pointer-events: none;
            display: none; /* Hidden by default, shown if demo data is used */
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .company-info {
            font-size: 11px;
            line-height: 1.4;
            width: 60%;
        }

        .company-info strong {
            font-size: 13px;
        }

        .logo {
            width: 150px;
            height: auto;
        }

        .delivery-note-title {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-top: 30px;
            margin-bottom: 5px;
        }

        .date {
            text-align: center;
            font-size: 12px;
            margin-bottom: 20px;
        }

        .customer-info {
            font-size: 12px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .customer-info div {
            display: flex;
        }

        .customer-info div span:first-child {
            width: 120px;
            flex-shrink: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 50px;
            font-size: 12px;
        }

        table th, table td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
        }

        table th {
            background-color: #f2f2f2;
            text-align: center;
        }

        .signatures {
            display: flex;
            justify-content: space-around;
            text-align: center;
            font-size: 12px;
        }

        .signature-block {
            width: 40%;
        }

        .signature-block p {
            margin-bottom: 60px; /* Space for signature */
        }
    </style>
</head>
<body>
    <div class="watermark" id="watermark">PHIẾU GIAO HÀNG DEMO</div>

    <div class="header">
        <div class="company-info">
            <strong>CN CÔNG TY TNHH XD TÍN THỊNH</strong><br>
            Địa chỉ: Số 8/13, Đường số 16, P. Bình Hưng Hòa, TP HCM<br>
            VP MT: Khối 3, phường Điện Bàn, TP Đà Nẵng<br>
            VP MB: số 117 Trần Duy Hưng, P. Trung Hòa, TP Hà Nội.<br>
            ĐT: 0933 676 123<br>
            Zalo OA: Siêu Thị Vật Tư (<a href="https://zalo.me/sieuthivattu">zalo.me/sieuthivattu</a>)<br>
            Email: vattutinthinh@gmail.com
        </div>
        <img src="https://i.imgur.com/your-logo-here.png" alt="SIÊU THỊ VẬT TƯ.COM Logo" class="logo"> <!-- Replace with your logo URL -->
    </div>

    <p class="delivery-note-title">PHIẾU GIAO HÀNG</p>
    <p class="date">Ngày: <span id="deliveryDate"></span></p>

    <div class="customer-info">
        <div><span>Khách hàng</span> : <span id="customerName"></span></div>
        <div><span>Dự án</span> : <span id="projectName"></span></div>
        <div><span>Địa chỉ nhận hàng</span> : <span id="deliveryAddress"></span></div>
    </div>

    <table>
        <thead>
            <tr>
                <th>STT</th>
                <th>TÊN VẬT TƯ</th>
                <th>ĐƠN VỊ</th>
                <th>SỐ LƯỢNG</th>
                <th>GHI CHÚ</th>
            </tr>
        </thead>
        <tbody id="itemTableBody">
            <!-- Items will be inserted here by JavaScript -->
        </tbody>
    </table>

    <div class="signatures">
        <div class="signature-block">
            <p>Người nhận hàng</p>
            <p>(Ký tên)</p>
        </div>
        <div class="signature-block">
            <p>Người lập</p>
            <p>(Ký tên)</p>
        </div>
    </div>

    <script>
        // Function to get query parameters
        function getQueryParams() {
            const params = {};
            window.location.search.substring(1).split('&').forEach(param => {
                const parts = param.split('=');
                if (parts[0]) {
                    params[decodeURIComponent(parts[0])] = decodeURIComponent(parts[1] || '');
                }
            });
            return params;
        }

        // Function to populate data
        function populateData() {
            const params = getQueryParams();
            let isDemo = true;

            // Populate header info
            document.getElementById('deliveryDate').textContent = params.deliveryDate || '01/09/2025';
            document.getElementById('customerName').textContent = params.customerName || 'CÔNG TY CỔ PHẦN THIẾT BỊ VÀ CÔNG NGHỆ XÂY DỰNG KEY GROUP';
            document.getElementById('projectName').textContent = params.projectName || 'STVT';
            document.getElementById('deliveryAddress').textContent = params.deliveryAddress || ''; // No demo for this, keep empty as per image

            // Populate table items
            const itemTableBody = document.getElementById('itemTableBody');
            let items = [];

            // AppSheet can pass data as JSON string in a single parameter or multiple parameters
            if (params.itemsJson) {
                try {
                    items = JSON.parse(params.itemsJson);
                    if (items.length > 0) isDemo = false;
                } catch (e) {
                    console.error("Error parsing itemsJson:", e);
                }
            } else if (params['item_name_1']) { // Example for individual item parameters
                let i = 1;
                while (params[`item_name_${i}`]) {
                    items.push({
                        name: params[`item_name_${i}`],
                        unit: params[`item_unit_${i}`],
                        quantity: params[`item_quantity_${i}`],
                        note: params[`item_note_${i}`] || ''
                    });
                    i++;
                }
                if (items.length > 0) isDemo = false;
            }

            if (items.length === 0) { // If no data from URL, use demo data
                items = [
                    { name: 'Matit gắn thép Ramset Epcon G5', unit: 'Chai', quantity: 30, note: '' },
                    { name: 'Súng bắn keo Ramset', unit: 'Cái', quantity: 2, note: '' },
                    { name: 'Miễn phí vận chuyển', unit: 'Chuyến', quantity: 1, note: '' }
                ];
                isDemo = true;
            } else {
                isDemo = false;
            }

            items.forEach((item, index) => {
                const row = itemTableBody.insertRow();
                row.insertCell(0).textContent = index + 1;
                row.insertCell(1).textContent = item.name;
                row.insertCell(2).textContent = item.unit;
                row.insertCell(3).textContent = item.quantity;
                row.insertCell(4).textContent = item.note;
            });

            // Show watermark if using demo data
            if (isDemo) {
                document.getElementById('watermark').style.display = 'block';
            }
        }

        // Run when the page loads
        document.addEventListener('DOMContentLoaded', populateData);
    </script>
</body>
</html>